# フロントエンド・テスト計画書

## 1. 概要

本プロジェクト（3D Viewer）におけるフロントエンドの品質を担保するためのテスト戦略を定義する。
3D 描画を含むアプリケーションであるため、通常の UI テストに加えて、Canvas 要素の表示確認やインタラクションの検証も考慮する。

## 2. テストの目的

- リファクタリング時の回帰テスト（リグレッションテスト）の効率化
- コンポーネントおよびロジック（Zustand ストア等）の動作保証
- 3D ビューワーとしての主要機能（モデルロード、操作）の E2E レベルでの動作確認

## 3. 採用するテスト技術スタック

モダンかつ高速な実行環境を重視し、以下のツールセットを採用する。

### 3.1. 単体・結合テスト (Unit / Integration Tests)

- **ツール**: **Vitest** + **React Testing Library**
- **選定理由**:
  - Jest と比較して高速な実行速度
  - Vite（将来的な移行や同等のエコシステム）との親和性
  - 設定が容易
- **対象**:
  - 汎用 UI コンポーネント（Button, Input 等）
  - カスタムフック
  - 状態管理ロジック（Zustand store）
  - ユーティリティ関数

### 3.2. E2E / ビジュアルテスト (E2E / Visual Regression)

- **ツール**: **Playwright**
- **選定理由**:
  - 複数のブラウザエンジン（Chromium, WebKit, Firefox）での並列実行
  - 強力なオートウェイト機能（Flaky テストの削減）
  - **Visual Regression Testing**（スクリーンショット比較）機能が標準搭載されており、3D 描画の崩れ検知に最適
- **対象**:
  - 主要なユーザーフロー（トップページ閲覧 → コレクション選択 → ビューワー表示）
  - 3D モデルの描画結果の確認（画像比較）
  - ページ遷移の確認

## 4. テストスコープと優先度

### Phase 1: 基盤構築と重要ロジック（最優先）

- テスト環境の構築（Vitest, Playwright のセットアップ）
- CI パイプライン（GitHub Actions）への統合
- 状態管理（Store）の単体テスト

### Phase 2: コンポーネントテスト

- 共通コンポーネントの表示・動作確認
- 多言語対応（i18n）の表示確認

### Phase 3: E2E・ビジュアルテスト

- 3D ビューワーの起動確認
- モデルロード成功の検証
- スナップショット比較による描画崩れ検知

## 5. ディレクトリ構造ルール

テストファイルは、可能な限り実装ファイルの近くに配置する（Co-location）。

```
src/
  components/
    ui/
      Button/
        Button.tsx
        Button.test.tsx  <-- 単体テスト
  hooks/
    useViewer/
      useViewer.ts
      useViewer.test.ts
e2e/
  specs/
    home.spec.ts         <-- E2Eテスト
  results/               <-- スクリーンショット等
```

## 6. 命名規則

- テストファイル: `*.test.tsx` または `*.test.ts`
- E2E テストファイル: `*.spec.ts`
- テスト記述: `describe`, `it` (または `test`) を使用し、具体的かつ断定的な説明文を書く。

## 7. CI/CD 連携

GitHub Actions において、Pull Request 作成時に以下を自動実行する。

1. Lint チェック
2. ビルドチェック
3. 単体・結合テスト (Vitest)
4. E2E テスト (Playwright) ※必要に応じて実行頻度を調整

以上
