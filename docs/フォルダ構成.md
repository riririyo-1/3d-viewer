# フォルダ構成

## プロジェクト全体構成

```plaintext
studio-view/
├── .github/                          # GitHub設定
├── docs/                             # ドキュメント
├── frontend/                         # Next.jsフロントエンド
├── server/                           # NestJS + Prismaバックエンド
├── pipeline/                         # FastAPI変換パイプライン
├── compose.yaml                      # Docker Compose設定
├── CLAUDE.md                         # プロジェクト開発ルール
└── README.md                         # プロジェクト概要
```

---

## Frontend (Next.js)

```plaintext
frontend/
├── public/                           # 静的ファイル
│   ├── glb/                          # GLBファイル
│   │   ├── FlexiSpot_cherryblossom
│   │   |   ├── FlexiSpot_cherryblossom.glb # 3Dモデル
│   │   |   └── FlexiSpot_cherryblossom.png # サムネイル画像
│   └── obj/
├── src/
│   ├── app/                          # App Router
│   │   ├── layout.tsx                # ルートレイアウト
│   │   ├── page.tsx                  # トップ画面 (/)
│   │   ├── globals.css               # グローバルスタイル
│   │   ├── api/                      # API Routes
│   │   │   ├── models/
│   │   │   │   └── route.ts          # パブリックモデルAPI
│   │   │   ├── assets/
│   │   │   │   ├── route.ts          # アセット一覧・作成API
│   │   │   │   └── [id]/
│   │   │   │       └── route.ts      # アセット詳細・削除API
│   │   │   ├── conversion/
│   │   │   │   ├── obj2glb/
│   │   │   │   │   └── route.ts      # OBJ→GLB変換API
│   │   │   │   └── obj2gltf/
│   │   │   │       └── route.ts      # OBJ→GLTF変換API
│   │   │   ├── settings/
│   │   │   │   └── route.ts          # ユーザー設定API
│   │   │   └── history/
│   │   │       └── recent/
│   │   │           └── route.ts      # 閲覧履歴API
│   │   ├── collection/
│   │   │   └── page.tsx              # コレクション画面 (/collection)
│   │   ├── viewer/
│   │   │   └── page.tsx              # 3Dビューワー画面 (/viewer)
│   │   ├── conversion/
│   │   │   └── page.tsx              # 変換画面 (/conversion)
│   │   ├── login/
│   │   │   └── page.tsx              # ログイン画面 (/login)
│   │   └── settings/
│   │       └── page.tsx              # 設定画面 (/settings)
│   ├── components/                   # Reactコンポーネント
│   │   ├── ui/                       # 汎用UIコンポーネント
│   │   │   ├── Button/
│   │   │   │   ├── Button.tsx
│   │   │   │   └── Button.test.tsx
│   │   │   ├── Card/
│   │   │   │   └── Card.tsx
│   │   │   ├── Input/
│   │   │   │   └── Input.tsx
│   │   │   ├── Select/
│   │   │   │   └── Select.tsx
│   │   │   └── Badge/
│   │   │       └── Badge.tsx
│   │   ├── layout/                   # レイアウトコンポーネント
│   │   │   ├── MainHeader.tsx        # メインヘッダー
│   │   │   ├── AccountButton.tsx     # アカウントメニュー
│   │   │   └── Footer.tsx            # フッター
│   │   ├── three/                    # Three.js関連コンポーネント
│   │   │   ├── ViewerCanvas.tsx      # 3Dビューワーキャンバス
│   │   │   └── ControlPanel.tsx      # ビューワーコントロール
│   │   ├── features/                 # 機能別コンポーネント
│   │   │   ├── collection/
│   │   │   │   ├── AssetCard.tsx     # アセットカード
│   │   │   │   ├── FileUpload.tsx    # ファイルアップロード
│   │   │   │   └── LibraryGrid.tsx   # ライブラリグリッド
│   │   │   ├── conversion/
│   │   │   │   ├── ConversionForm.tsx# 変換フォーム
│   │   │   │   └── ConversionResult.tsx# 変換結果表示
│   │   │   └── settings/
│   │   │       ├── AccountInfo.tsx   # アカウント情報
│   │   │       ├── LanguageSelector.tsx# 言語選択
│   │   │       └── StorageUsage.tsx  # ストレージ使用状況
│   │   └── providers/                # Context Providers
│   │       ├── LanguageProvider.tsx  # 言語プロバイダー
│   │       └── AuthProvider.tsx      # 認証プロバイダー
│   ├── lib/                          # ユーティリティとロジック
│   │   ├── utils.ts                  # ヘルパー関数 (cn等)
│   │   ├── store.ts                  # Zustand状態管理
│   │   ├── i18n.ts                   # 国際化設定
│   │   ├── api-client.ts             # APIクライアント
│   │   └── validators.ts             # バリデーション関数
│   ├── locales/                      # 多言語対応
│   │   ├── en.json                   # 英語翻訳
│   │   └── ja.json                   # 日本語翻訳
│   ├── types/                        # TypeScript型定義
│   │   ├── asset.ts                  # アセット型
│   │   ├── user.ts                   # ユーザー型
│   │   ├── api.ts                    # APIレスポンス型
│   │   └── index.ts                  # 型エクスポート
│   └── hooks/                        # カスタムReact Hooks
│       ├── useAssets.ts              # アセット管理フック
│       ├── useAuth.ts                # 認証フック
│       └── useLanguage.ts            # 言語フック
├── test/                             # テスト
│   ├── e2e/                          # E2Eテスト
│   │   ├── home.spec.ts
│   │   ├── collection.spec.ts
│   │   ├── viewer.spec.ts
│   │   ├── results/                  # テスト結果
│   │   └── report/                   # レポート
│   └── setup.ts                      # テストセットアップ
├── .env.local                        # ローカル環境変数
├── .env.example                      # 環境変数サンプル
├── package.json                      # 依存関係
├── pnpm-lock.yaml                    # パッケージロック
├── tsconfig.json                     # TypeScript設定
├── next.config.ts                    # Next.js設定
├── vitest.config.ts                  # Vitest設定
├── playwright.config.ts              # Playwright設定
├── tailwind.config.ts                # Tailwind CSS設定
├── eslint.config.mjs                 # ESLint設定
└── Dockerfile                        # Docker設定
```

---

## Server (NestJS + Prisma)

```plaintext
server/
├── prisma/
│   ├── schema.prisma                 # Prismaスキーマ（docs/DB設計.mdから）
│   ├── migrations/                   # マイグレーション
│   └── seed.ts                       # シーディング
├── src/
│   ├── modules/                      # 機能モジュール（NestJS）
│   │   ├── auth/
│   │   │   ├── auth.module.ts
│   │   │   ├── auth.controller.ts
│   │   │   ├── auth.service.ts
│   │   │   ├── dto/
│   │   │   │   ├── login.dto.ts
│   │   │   │   └── refresh-token.dto.ts
│   │   │   ├── guards/
│   │   │   │   └── jwt-auth.guard.ts
│   │   │   └── strategies/
│   │   │       └── jwt.strategy.ts
│   │   ├── assets/
│   │   │   ├── assets.module.ts
│   │   │   ├── assets.controller.ts
│   │   │   ├── assets.service.ts
│   │   │   ├── dto/
│   │   │   │   ├── create-asset.dto.ts
│   │   │   │   ├── get-assets.dto.ts
│   │   │   │   └── asset-response.dto.ts
│   │   │   └── entities/
│   │   │       └── asset.entity.ts
│   │   ├── conversion/
│   │   │   ├── conversion.module.ts
│   │   │   ├── conversion.controller.ts
│   │   │   ├── conversion.service.ts
│   │   │   ├── dto/
│   │   │   │   ├── convert-obj2glb.dto.ts
│   │   │   │   └── job-status.dto.ts
│   │   │   ├── processors/
│   │   │   │   └── conversion.processor.ts  # BullMQワーカー
│   │   │   └── entities/
│   │   │       └── conversion-job.entity.ts
│   │   ├── settings/
│   │   │   ├── settings.module.ts
│   │   │   ├── settings.controller.ts
│   │   │   ├── settings.service.ts
│   │   │   └── dto/
│   │   │       └── update-settings.dto.ts
│   │   └── history/
│   │       ├── history.module.ts
│   │       ├── history.controller.ts
│   │       ├── history.service.ts
│   │       └── dto/
│   │           └── recent-assets.dto.ts
│   ├── infrastructure/               # インフラ層
│   │   ├── database/
│   │   │   ├── prisma.module.ts      # PrismaモジュールNestJS用
│   │   │   ├── prisma.service.ts     # Prismaクライアント
│   │   │   └── repositories/
│   │   │       ├── user.repository.ts
│   │   │       ├── asset.repository.ts
│   │   │       └── conversion-job.repository.ts
│   │   ├── storage/
│   │   │   ├── storage.module.ts
│   │   │   └── minio.service.ts      # MinIOクライアント
│   │   ├── queue/
│   │   │   ├── queue.module.ts
│   │   │   └── bullmq.service.ts     # BullMQクライアント
│   │   └── cache/
│   │       ├── cache.module.ts
│   │       └── redis.service.ts      # Redisクライアント
│   ├── common/                       # 共通コード
│   │   ├── decorators/
│   │   │   └── current-user.decorator.ts
│   │   ├── filters/
│   │   │   └── http-exception.filter.ts
│   │   ├── interceptors/
│   │   │   ├── logging.interceptor.ts
│   │   │   └── transform.interceptor.ts
│   │   ├── guards/
│   │   │   └── throttler.guard.ts    # レート制限
│   │   ├── pipes/
│   │   │   └── validation.pipe.ts
│   │   └── constants/
│   │       └── queue-names.ts
│   ├── config/
│   │   ├── configuration.ts          # 環境変数設定
│   │   ├── database.config.ts
│   │   ├── jwt.config.ts
│   │   ├── minio.config.ts
│   │   └── redis.config.ts
│   ├── app.module.ts                 # ルートモジュール
│   └── main.ts                       # エントリーポイント
├── test/
│   ├── unit/                         # ユニットテスト
│   ├── integration/                  # 統合テスト（e2e）
│   └── jest-e2e.json
├── .env                              # 環境変数
├── .env.example                      # 環境変数サンプル
├── package.json
├── tsconfig.json
├── nest-cli.json
└── Dockerfile
```

---

## Pipeline (FastAPI)

```plaintext
pipeline/
├── src/
│   ├── domain/
│   │   ├── models/
│   │   │   ├── conversion_request.py
│   │   │   └── conversion_result.py
│   │   └── services/
│   │       └── conversion_service.py
│   ├── application/
│   │   ├── usecases/
│   │   │   ├── obj_to_glb_usecase.py
│   │   │   └── obj_to_gltf_usecase.py
│   │   └── dto/
│   │       └── conversion_dto.py
│   ├── infrastructure/
│   │   ├── converters/
│   │   │   ├── obj2gltf_converter.py    # obj2gltfツールのラッパー
│   │   │   └── gltf2glb_converter.py    # GLTF→GLB変換
│   │   └── validators/
│   │       └── model_validator.py        # ファイル検証
│   ├── presentation/
│   │   ├── routers/
│   │   │   ├── conversion.py
│   │   │   └── health.py
│   │   └── schemas/
│   │       ├── request.py
│   │       └── response.py
│   ├── config/
│   │   └── settings.py
│   └── main.py
├── tests/
│   ├── unit/
│   └── integration/
├── temp/                               # 一時ファイル保存先
├── requirements.txt
├── pytest.ini
└── Dockerfile
```
